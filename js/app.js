(function(){window.app=window.app||{},app.Component=function(t){return t},app.Service=function(t){return t},document.addEventListener("DOMContentLoaded",function(){var t;return void 0,t={url:"",get:function(t){return this.url=t,this},map:function(t){return this},toPromise:function(){return new Promise(function(t){return function(e){return jQuery.ajax({url:t.url,complete:e})}}(this))}},app.ArticlesService.http=t,app.TimelineComponent.nativeElement=document.querySelector(".timeline"),app.TimelineComponent.mainSvg=d3.select(document.querySelector("svg")),app.TimelineComponent.ArticlesService=app.ArticlesService,app.TimelineComponent.onOpenTitle={emit:function(t){return app.ArticleComponent.openTitle(t)}},app.ArticleComponent.ArticlesService=app.ArticlesService,app.ArticleComponent.nativeElement=document.querySelector("article"),app.PagelinkComponent.onOpenPage={emit:function(t){return app.ArticleComponent.openTitle(t)}},app.TimelineComponent.ngOnInit(),app.ArticleComponent.ngOnInit(),app.PagelinkComponent.ngOnInit()})}).call(this),function(){var t,e;window.app=window.app||{},t="https://api.github.com/repos/mlhch/articles/git/refs",e=new showdown.Converter({noHeaderId:!0}),app.ArticlesService=app.Service({getTitles:function(){var t;return t="/branches.json",this.http.get(t).map(function(t){return t.json()}).toPromise().then(function(t){var e;return e=[],t.forEach(function(t){var n,i,r;return i=t.ref.split("/").pop().split("_"),r=i[0],n=i[1],n?e.push({time:r,title:b64_decode(n)}):void 0}),e})},getArticle:function(t){var n;return n=t.url||"https://raw.githubusercontent.com/mlhch/articles/"+t.time+"_"+b64_encode(t.title)+"/"+t.title,this.http.get(n).map(function(t){return t.json()}).toPromise().then(function(t){return{content:"#"===t[0]?e.makeHtml(t):t}})}})}.call(this),function(){var t,e;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,"+":62,"/":63},window.b64_decode=function(e){var n,i;return i=[],e.split("").forEach(function(e,n,r){var a,o,s,l,u,c,p;return n%4===0&&(a=t[r[n]],o=t[r[n+1]],s=t[r[n+2]],l=t[r[n+3]],u=(a<<2)+(o>>4),i.push(u),"number"==typeof s&&(c=(o%16<<4)+(s>>2),i.push(c),"number"==typeof l))?(p=(s%4<<6)+l,i.push(p)):void 0}),n=[],i.forEach(function(t,e,i){var r,a;return 128>t?n.push(String.fromCharCode(t)):t>=192&&224>t?(r=i[e+1],n.push(String.fromCharCode((t-192<<6)+(r-128)))):t>=224&&240>t?(r=i[e+1],a=i[e+2],n.push(String.fromCharCode((t-224<<12)+(r-128<<6)+(a-128)))):t>=240?void 0:void 0}),n.join("")},window.b64_encode=function(t){var n,i;return i=[],t.split("").forEach(function(t,e,n){return t=t.charCodeAt(0),128>t?i.push(t):2048>t?(i.push((t>>6)+192),i.push(t%64+128)):65535>t?(i.push((t>>12)+224),i.push((t>>6)%64+128),i.push(t%64+128)):t>=240?void 0:void 0}),n=[],i.forEach(function(t,i,r){var a,o;return i%3===0?(n.push(e[t>>2]),"undefined"==typeof(a=r[i+1])?(n.push(e[t%4<<4]),n.push("="),void n.push("=")):(n.push(e[(t%4<<4)+(a>>4)]),"undefined"==typeof(o=r[i+2])?(n.push(e[a%16<<2]),n.push("=")):(n.push(e[(a%16<<2)+(o>>6)]),n.push(e[o%64])))):void 0}),n.join("")}}.call(this),function(){window.drawClock=function(t){var e,n,i,r,a,o,s;return i=function(){var t,e;return e=new Date,t=e.getMinutes()/60,[{radius:.9*o,width:2,value:e.getSeconds()/60},{radius:.7*o,width:3,value:t},{radius:.5*o,width:5,value:(e.getHours()+t)/12}].map(function(t){return t.color=t.color||"#85defe",t})},a=function(){var t,e;return e=new Date,t=.95*o,[{value:(e.getDate()-1)/(32-new Date(e.getYear(),e.getMonth(),32).getDate()),innerRadius:t,outerRadius:t+5,color:"#85defe",width:2},{value:(e.getMonth()+1)/12,innerRadius:t+1,outerRadius:t+4,fill:"#85defe"}]},o=80,e=d3.arc().startAngle(2*Math.PI/12).endAngle(function(t){return 2*t.value*Math.PI}).innerRadius(function(t){return t.innerRadius||t.radius}).outerRadius(function(t){return t.outerRadius||t.radius+4}),r=t.selectAll("line").data(i).enter().append("line").style("stroke",function(t){return t.color}).style("stroke-width",function(t){return t.width}),n=t.selectAll("path").data(a).enter().append("path").style("stroke",function(t){return t.color}).style("fill",function(t){return t.fill||null}).style("stroke-width",function(t){return t.width}),s=function(){return r.each(function(t){return this._lastValue=t.value}).data(i).each(function(t){return t.previousValue=t.value>=this._lastValue?this._lastValue:this._lastValue-1}),n.each(function(t){return this._lastValue=t.value}).data(a).each(function(t){return t.previousValue=t.value>=this._lastValue?this._lastValue:this._lastValue-1}),r.transition().ease(d3.easeElastic).tween("move",function(t){var e;return e=d3.interpolateNumber(t.previousValue,t.value),function(n){return function(i){var r;return t.value=e(i),r=2*t.value*Math.PI,d3.select(n).attr("x1",t.radius*Math.sin(r)).attr("y1",-t.radius*Math.cos(r))}}(this)}),n.transition().ease(d3.easeElastic).attrTween("d",function(t){var n;return n=d3.interpolateNumber(t.previousValue,t.value),function(i){return function(i){return t.value=n(i),e(t)}}(this)}),setTimeout(s,1e3-Date.now()%1e3),jQuery(".axis g:last tspan").html((new Date).toLocaleString())},d3.transition().duration(0).each(s)}}.call(this),function(){window.drawTimeline=function(t,e,n){var i,r,a,o,s,l,u,c,p,d,h,f,m,g,v,w,y,k,T,S,C,x,A;return d=t.mainSvg,h=t.margin,f=t.onclick,A=Object.keys(n),v=parseInt(d.attr("width")),g=parseInt(d.attr("height")),T=v-h.left-h.right,p=g-h.top-h.bottom,m=d.append("g").attr("transform","translate("+h.left+","+h.top+")"),r=80,i=10,o=17,a=10,l=15,s=10,c=function(t,e,n,i){var r,l,u,p,d,h;return p=c,p.offset=p.offset||0,h=0,d=e.append("g"),t.posts.forEach(function(e,i){var r;if(t.hasTitle)return r=e.url?d:d,r=r.append("text").attr("class","title").attr("x",0).attr("y",h),S(r,e.title,n),h=r.node().getBBox().height+s}),r=d.node().getBoundingClientRect(),u=r.width,l=r.height+o+a,(t.isTitleOnLeft||t.isTitleOnRight)&&(p.prevPos&&(p.offset+=l-(p.prevPos-i)),e.attr("transform",e.attr("transform")+(" translate(0, "+-p.offset+")"))),p.prevPos=i,d.attr("width",u),d.attr("height",l),d},c.offset=0,S=function(t,e,n){var i,r,a;return r=t.append("tspan"),a=[],i=0,e.split(" ").forEach(function(e,o){return a.push(e),r.text(a.join(" ")),r.attr("x",0),r.attr("dy",i&&l||0),n<r.node().getBoundingClientRect().width?(r.text(a.splice(0,a.length-1).join(" ")),r=t.append("tspan"),i++):void 0})},x=d3.scaleLog().domain(e.years2ticks([e.floatYear(),A[0]])).range([0,p]),C=d3.axisRight().scale(x).tickValues(e.years2ticks(A,!0)).tickFormat(function(t){var i,r,a;return a=e.tick2year(t),r=n[a],i=r&&r.filter(function(t){return t.alias}),i&&i.length&&i[0].alias||a}).tickSize(0,0).tickPadding(0),y=m.append("g").attr("class","x axis").attr("transform","translate("+T/2+", 0)").call(C),y.insert(function(){return y.select("path").node()},":first-child"),w=y.insert("g",":first-child").attr("class","lines"),k=0,u={},y.selectAll(".tick").each(function(t,i){var r,a,o;return o=e.tick2year(t),r=n[o],a=r&&(r.title||r[0]&&r[0].title),a&&k++,u[o]={posts:Array.isArray(r)?r:[r],hasTitle:!!a,isSolidYear:!o.match(/\.\d+$/),isSolidMonth:r&&r[0]&&r[0].isSolidMonth,isTitleOnRight:i&&k%2===0,isTitleOnLeft:i&&k%2===1}}),y.selectAll(".tick").each(function(t,n){var a,s,l,p,d,h,f,m,g,v,y;return m=e.tick2year(t),a=u[m],p=d3.select(this),a.isSolidYear&&(p.attr("class","solid "+p.attr("class")),p.append("circle").attr("r",6)),a.isSolidMonth&&(p.attr("class","solid month "+p.attr("class")),p.append("circle").attr("r",4)),g=T/2-r,v=c(a,p,g,x(t)),y=v.node().getBoundingClientRect().width,d=p.select("text"),l=d.node().getBBox(),h=w.append(function(){return p.select("line").node()}),a.isSolidYear&&h.attr("class","solid"),f=r+Math.max(y,l.width),a.isSolidYear||(f-=l.width+i),0===n&&(s=(i+l.width+y)/2,d.attr("x",-s),d.attr("y",13),(a.posts[0].alias||a.posts[0].title)&&v.attr("transform","translate("+(i+l.width-s)+", "+o+")")),a.isTitleOnRight&&(a.hasTitle&&(h.attr("x1",f),v.attr("transform","translate("+r+", "+o+")")),a.isSolidYear||a.isSolidMonth?d.attr("x",-i-l.width):(d.attr("x",f+i),d.attr("dy",0))),a.isTitleOnLeft&&(a.hasTitle&&(h.attr("x1",-f),v.attr("transform","translate("+(-r-y)+", "+o+")")),a.isSolidYear||a.isSolidMonth?d.attr("x",i):(d.attr("x",-l.width-i-f),d.attr("dy",0))),h.attr("transform",p.attr("transform"))}),d.attr("height",g+c.offset),y.attr("transform",y.attr("transform")+(" translate(0, "+c.offset+")")),y.select("path").attr("d","M0,"+-c.offset+"H0V"+p+"H0"),y.selectAll(".tick").on("click",function(t){var n,i,r;return r=e.tick2year(t),n=u[r],n.posts[0].time?(d3.event.cancelBubble=!0,i=d3.event.target,f(n.posts[0],i)):void 0})}}.call(this),function(){var t;window.app=window.app||{},t={"2014.282000":{alias:"Apr 13",title:"This page is online"},2011:{title:"start as freelancer in oDesk"},2008:{title:"start out sourcing experience"},2006:{title:"start in IT industry"},2004:{title:"graduated from college"},"2016-03-26":{alias:"Mar. 26",title:"Timeline is now flexible for titles"}},app.TimelineComponent=app.Component({ngOnInit:function(){return this.mainSvg=d3.select(this.nativeElement.querySelector("svg")),this.svgWidth=this.nativeElement.getBoundingClientRect().width,this.svgHeight=1e4,this.mainSvg.attr("width",this.svgWidth).attr("height",this.svgHeight),this.drawClock(),this.ArticlesService.getTitles().then(function(t){return function(e){return t.drawTimeline(e)}}(this))},drawClock:function(){var t,e,n;return e=this.svgWidth/2,n=100,t=this.mainSvg.append("g").attr("transform","translate("+e+","+n+")").attr("opacity",.2),drawClock(t,e,n)},drawTimeline:function(e){var n,i,r,a,o,s,l,u,c,p,d,h;l=YearsAndTicks(),p=YearsAndTicks.date2tick(n=new Date),t[p]={title:n.toLocaleString(),alias:"Now"};for(o in t)d=t[o],o.match(/\d{4}-\d{2}-\d{2}/)&&(delete t[o],o=YearsAndTicks.date2tick(o),t[o]=d),d instanceof Array||(t[o]=[d]);for(h=r=2011,u=l.fullYear();u>=2011?u>=r:r>=u;h=u>=2011?++r:--r)h=h.toString(),t[h]||(t[h]=[]);for(i=a=0;44>=a;i=++a)n=new Date(2012+Math.floor(i/11),1+i%11),p=YearsAndTicks.date2tick(n),t[p]||(t[p]=[]),t[p].push({alias:d3.timeFormat("%b")(n),isSolidMonth:!0});for(i=s=1,c=(new Date).getMonth();c>=1?c>=s:s>=c;i=c>=1?++s:--s)n=new Date(l.fullYear(),i),p=YearsAndTicks.date2tick(n),t[p]||(t[p]=[]),t[p].push({alias:d3.timeFormat("%b")(n),isSolidMonth:!0});return e.map(function(e){return n=new Date(1e3*e.time),p=YearsAndTicks.date2tick(n),t[p]||(t[p]=[]),t[p].push({alias:d3.timeFormat(p>l.fullYear()?"%a, %b %d":"%a, %b %d, %Y")(n),time:e.time,title:e.title,url:e.url})}),drawTimeline({mainSvg:this.mainSvg,margin:{top:200,right:20,bottom:120,left:20},onclick:function(t){return function(e,n){return t.onOpenTitle.emit({post:e,target:n})}}(this)},l,t)}})}.call(this),function(){var t;t=function(t){var e,n,i,r,a,o,s,l,u;return e=864e5,"string"==typeof t&&(t=new Date(Date.parse(t))),"number"==typeof t&&(t=new Date(t)),n={date:t||new Date},l=function(){return n.start||(n.start=new Date(s(),0,1))},a=function(){return n.end||(n.end=new Date(s()+1,0,1))},i=function(){return n.day||(n.day=(n.date-l())/e)},r=function(){return n.days||(n.days=(a()-l())/e)},s=function(){return n.fullYear||(n.fullYear=n.date.getFullYear())},o=function(){return(s()+i()/r()).toFixed(6)},u=function(t){return t-s()-(t>0&&1||0)},{fullYear:s,floatYear:o,years2ticks:function(t,e){return t=t.map(u),e?t.sort(function(t,e){return t-e}):t},tick2year:function(t){return t+=s(),t+=t>=0&&1||0,t.toFixed(6).replace(/\.000000$/,"")},tick2date:function(t){var e,n,i;return t+=s(),0>t?!1:(t++,i=Math.floor(t),n=new Date(i,0),e=new Date(i+1,0),new Date(n.getTime()+(e-n)*(t-i)))}}},t.date2tick=function(e){var n;return n=t(e),n.floatYear()},window.YearsAndTicks=t}.call(this),function(){window.app=window.app||{},app.ArticleComponent=app.Component({ngOnInit:function(){return jQuery("body").click(function(t){return function(e){var n,i;for(i=e.target,n=!1;i;)i===t.nativeElement&&(n=!0),i=i.parentNode;return n?void 0:(t.nativeElement.style.visibility="hidden",t.nativeElement.innerHTML="")}}(this))},openTitle:function(t){var e,n;return e=t.post,n=t.target,Promise.all([this.ArticlesService.getArticle(e),new Promise(function(t){return function(e){return t.animatePopupImmediately(n,e)}}(this))]).then(function(t){return function(e){return t.showArticleContent(e[0])}}(this))},showArticleContent:function(t){return this.nativeElement.innerHTML=t.content,this.nativeElement.style.height="auto"},animatePopupImmediately:function(t,e){var n,i,r,a,o,s,l,u;return l=jQuery(t).offset(),s=jQuery("article").html("Loading..."),o=jQuery("#clip").hide(),u=s.clone(),r=document.body.scrollTop+100,a=.7*document.body.clientWidth,i=.15*document.body.clientWidth,n=document.documentElement.clientHeight-200,s.replaceWith(u),s.css({top:r+"px",left:i-20+"px",width:a+"px",height:n+"px",visibility:"visible"}),o.append(s).css({position:"absolute",width:jQuery(t).width(),height:jQuery(t).height(),overflow:"hidden",opacity:.2,left:l.left+"px",top:l.top+"px","background-color":"white"}).show().animate({position:"absolute",left:i-20+"px",top:r+"px",opacity:1,width:a+40+"px",height:n+40+"px"},{duration:500,easing:"easeOutExpo",specialEasing:{opacity:"easeInOutQuint"},complete:function(){return o.hide(),u.replaceWith(s),setTimeout(e,100)}})}})}.call(this),function(){window.app=window.app||{},app.PagelinkComponent={ngOnInit:function(){return jQuery(".page-link").click(function(t){return function(e){return e.preventDefault(),e.stopImmediatePropagation(),t.onOpenPage.emit({target:e.target,post:{url:e.target.href}})}}(this))}}}.call(this);